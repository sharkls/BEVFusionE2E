# BEVFusion算法配置文件 - Protobuf文本格式
# 文件路径: exePath.parent_path() / "configs" / "algorithm" / "BEVFusionAlgConfig.conf"
# 基于BEVFusionConfig.proto和CameraConfig.proto设计

# 基础配置参数
confidence_threshold: 0.12
enable_timer: true
num_camera: 6
model_name: "resnet50int8"
precision: "int8"

# 相机配置列表
cameras {
  # 相机0配置 - 从main.cpp的example-data中提取的实际数据
  intrinsics: [1266.417236, 0.0, 816.267029, 0.0, 0.0, 1266.417236, 491.507080, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0] # 相机内参矩阵 (4x4矩阵，按行优先顺序排列)
  camera2lidar: [0.999971, 0.006705, -0.003616, -0.012627, 0.003491, 0.018583, 0.999821, 0.764882, 0.006771, -0.999805, 0.018559, -0.310931, 0.0, 0.0, 0.0, 1.0] # 相机到激光雷达变换矩阵 (4x4矩阵，按行优先顺序排列)
  lidar2image: [1263.428711, 820.542236, 23.724329, -604.287109, 6.714038, 514.953308, -1257.047974, -784.649231, -0.003616, 0.999821, 0.018559, -0.759020, 0.0, 0.0, 0.0, 1.0] # 激光雷达到图像变换矩阵 (4x4矩阵，按行优先顺序排列)
  img_aug_matrix: [0.48, 0.0, 0.0, -32.0, 0.0, 0.48, 0.0, -176.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0] # 图像增强矩阵 (4x4矩阵，按行优先顺序排列)
  
  # 相机归一化参数
  image_width: 1600
  image_height: 900
  output_width: 704
  output_height: 256
  resize_lim: 0.48
  
  # 图像归一化参数
  mean: [0.485, 0.456, 0.406]
  std: [0.229, 0.224, 0.225]
  scale_factor: 0.003921568627451
  offset: 0.0
  interpolation: "Bilinear"  # 图像插值方法："Bilinear" 或 "Nearest"
}

cameras {
  # 相机1配置 - 从main.cpp的example-data中提取的实际数据
  intrinsics: [1260.847412, 0.0, 807.968262, 0.0, 0.0, 1260.847412, 495.334412, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]
  camera2lidar: [0.551653, -0.010494, 0.834008, 0.496534, -0.833668, 0.024250, 0.551733, 0.614232, -0.026014, -0.999651, 0.004629, -0.326786, 0.0, 0.0, 0.0, 1.0]
  lidar2image: [1369.401855, -605.345215, -29.059496, -317.629272, 399.881927, 303.867493, -1258.114258, -796.335022, 0.834008, 0.551733, 0.004629, -0.751493, 0.0, 0.0, 0.0, 1.0]
  img_aug_matrix: [0.48, 0.0, 0.0, -32.0, 0.0, 0.48, 0.0, -176.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]
  image_width: 1600
  image_height: 900
  output_width: 704
  output_height: 256
  resize_lim: 0.48
  mean: [0.485, 0.456, 0.406]
  std: [0.229, 0.224, 0.225]
  scale_factor: 0.003921568627451
  offset: 0.0
  interpolation: "Bilinear"  # 图像插值方法："Bilinear" 或 "Nearest"
}

cameras {
  # 相机2配置 - 从main.cpp的example-data中提取的实际数据
  intrinsics: [1272.597900, 0.0, 826.615479, 0.0, 0.0, 1272.597900, 479.751648, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]
  camera2lidar: [0.572936, 0.002660, -0.819596, -0.491699, 0.819328, 0.023893, 0.572827, 0.589088, 0.021106, -0.999711, 0.011510, -0.319629, 0.0, 0.0, 0.0, 1.0]
  lidar2image: [51.627274, 1516.182739, 36.373707, -856.153381, -389.817749, 305.220612, -1266.708130, -776.350830, -0.819596, 0.572827, 0.011510, -0.736760, 0.0, 0.0, 0.0, 1.0]
  img_aug_matrix: [0.48, 0.0, 0.0, -32.0, 0.0, 0.48, 0.0, -176.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]
  image_width: 1600
  image_height: 900
  output_width: 704
  output_height: 256
  resize_lim: 0.48
  mean: [0.485, 0.456, 0.406]
  std: [0.229, 0.224, 0.225]
  scale_factor: 0.003921568627451
  offset: 0.0
  interpolation: "Bilinear"  # 图像插值方法："Bilinear" 或 "Nearest"
}

cameras {
  # 相机3配置 - 从main.cpp的example-data中提取的实际数据
  intrinsics: [809.221008, 0.0, 829.219604, 0.0, 0.0, 809.221008, 481.778412, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]
  camera2lidar: [-0.999941, 0.009813, -0.004621, -0.003818, 0.004695, 0.007458, -0.999961, -0.908765, -0.009778, -0.999924, -0.007504, -0.283258, 0.0, 0.0, 0.0, 1.0]
  lidar2image: [-813.005432, -825.388428, -14.135155, -757.192444, 5.714562, -475.724304, -812.774780, -662.524841, -0.004621, -0.999961, -0.007504, -0.910873, 0.0, 0.0, 0.0, 1.0]
  img_aug_matrix: [0.48, 0.0, 0.0, -32.0, 0.0, 0.48, 0.0, -176.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]
  image_width: 1600
  image_height: 900
  output_width: 704
  output_height: 256
  resize_lim: 0.48
  mean: [0.485, 0.456, 0.406]
  std: [0.229, 0.224, 0.225]
  scale_factor: 0.003921568627451
  offset: 0.0
  interpolation: "Bilinear"  # 图像插值方法："Bilinear" 或 "Nearest"
}

cameras {
  # 相机4配置 - 从main.cpp的example-data中提取的实际数据
  intrinsics: [1256.741455, 0.0, 792.112549, 0.0, 0.0, 1256.741455, 492.775757, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]
  camera2lidar: [-0.317050, 0.019890, -0.948200, -0.483137, 0.948083, 0.032856, -0.316322, 0.099050, 0.024862, -0.999262, -0.029274, -0.249790, 0.0, 0.0, 0.0, 1.0]
  lidar2image: [-1149.531250, 940.932678, 8.056522, -646.568420, -442.253235, -114.584534, -1270.239990, -519.613281, -0.948200, -0.316322, -0.029274, -0.434092, 0.0, 0.0, 0.0, 1.0]
  img_aug_matrix: [0.48, 0.0, 0.0, -32.0, 0.0, 0.48, 0.0, -176.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]
  image_width: 1600
  image_height: 900
  output_width: 704
  output_height: 256
  resize_lim: 0.48
  mean: [0.485, 0.456, 0.406]
  std: [0.229, 0.224, 0.225]
  scale_factor: 0.003921568627451
  offset: 0.0
  interpolation: "Bilinear"  # 图像插值方法："Bilinear" 或 "Nearest"
}

cameras {
  # 相机5配置 - 从main.cpp的example-data中提取的实际数据
  intrinsics: [1259.513794, 0.0, 807.252930, 0.0, 0.0, 1259.513794, 501.195801, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]
  camera2lidar: [-0.356907, -0.005454, 0.934124, 0.482256, -0.933464, 0.040114, -0.356420, 0.076840, -0.035528, -0.999180, -0.019408, -0.273229, 0.0, 0.0, 0.0, 1.0]
  lidar2image: [304.545685, -1463.432373, -60.415245, -50.926125, 461.309662, -128.111679, -1268.208496, -559.136658, 0.934124, -0.356420, -0.019408, -0.428402, 0.0, 0.0, 0.0, 1.0]
  img_aug_matrix: [0.48, 0.0, 0.0, -32.0, 0.0, 0.48, 0.0, -176.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]
  image_width: 1600
  image_height: 900
  output_width: 704
  output_height: 256
  resize_lim: 0.48
  mean: [0.485, 0.456, 0.406]
  std: [0.229, 0.224, 0.225]
  scale_factor: 0.003921568627451
  offset: 0.0
  interpolation: "Bilinear"  # 图像插值方法："Bilinear" 或 "Nearest"
}

# 激光雷达配置
lidar_config {
  # 体素化参数
  min_range: [-54.0, -54.0, -5.0]
  max_range: [54.0, 54.0, 3.0]
  voxel_size: [0.075, 0.075, 0.2]
  grid_size: [1440, 1440, 40]
  max_points_per_voxel: 10
  max_points: 300000
  max_voxels: 160000
  num_feature: 5
  
  # SCN参数
  lidar_model_path: "model/resnet50int8/lidar.backbone.xyz.onnx"
  coordinate_order: "XYZ"
}

# 几何配置
geometry_config {
  xbound: [-54.0, 54.0, 0.3]
  ybound: [-54.0, 54.0, 0.3]
  zbound: [-10.0, 10.0, 20.0]
  dbound: [1.0, 60.0, 0.5]
  image_width: 704
  image_height: 256
  feat_width: 88
  feat_height: 32
  num_camera: 6
  geometry_dim: [360, 360, 80]
}

# 后处理配置
postprocessor_config {
  out_size_factor: 8
  pc_range: [-54.0, -54.0]
  post_center_range_start: [-61.2, -61.2, -10.0]
  post_center_range_end: [61.2, 61.2, 10.0]
  voxel_size: [0.075, 0.075]
  sorted_bboxes: true
}

# 模型路径配置
model_paths {
  camera_backbone_path: "model/resnet50int8/build/camera.backbone.plan"
  lidar_backbone_path: "model/resnet50int8/lidar.backbone.xyz.onnx"
  fuser_path: "model/resnet50int8/build/fuser.plan"
  head_bbox_path: "model/resnet50int8/build/head.bbox.plan"
  camera_vtransform_path: "model/resnet50int8/build/camera.vtransform.plan"
}
